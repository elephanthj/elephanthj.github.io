import{c as w,ag as k,b as N,t as U,d as B,G as P,aY as R,K as _,aZ as F,ae as G,ab as V,a as r,Q as y,aW as L,al as I,w as C,Y as K,r as Q,a_ as W,aa as X}from"./_plugin-vue_export-helper-bbba385e.js";import{e as Z,L as Y,u as j}from"./index-16e70b89.js";import{u as q}from"./index-208ffc04.js";const[z,T,J]=w("list"),O={error:Boolean,offset:k(300),loading:Boolean,disabled:Boolean,finished:Boolean,errorText:String,direction:N("down"),loadingText:String,finishedText:String,immediateCheck:U};var p=B({name:z,props:O,emits:["load","update:error","update:loading"],setup(e,{emit:d,slots:i}){const l=P(e.loading),f=P(),v=P(),h=q(),a=R(f),o=()=>{y(()=>{if(l.value||e.finished||e.disabled||e.error||(h==null?void 0:h.value)===!1)return;const{offset:n,direction:g}=e,u=L(a);if(!u.height||I(f))return;let m=!1;const D=L(v);g==="up"?m=u.top-D.top<=n:m=D.bottom-u.bottom<=n,m&&(l.value=!0,d("update:loading",!0),d("load"))})},H=()=>{if(e.finished){const n=i.finished?i.finished():e.finishedText;if(n)return r("div",{class:T("finished-text")},[n])}},x=()=>{d("update:error",!1),o()},E=()=>{if(e.error){const n=i.error?i.error():e.errorText;if(n)return r("div",{role:"button",class:T("error-text"),tabindex:0,onClick:x},[n])}},c=()=>{if(l.value&&!e.finished&&!e.disabled)return r("div",{class:T("loading")},[i.loading?i.loading():r(Y,{class:T("loading-icon")},{default:()=>[e.loadingText||J("loading")]})])};return _(()=>[e.loading,e.finished,e.error],o),h&&_(h,n=>{n&&o()}),F(()=>{l.value=e.loading}),G(()=>{e.immediateCheck&&o()}),Z({check:o}),V("scroll",o,{target:a,passive:!0}),()=>{var n;const g=(n=i.default)==null?void 0:n.call(i),u=r("div",{ref:v,class:T("placeholder")},null);return r("div",{ref:f,role:"feed",class:T(),"aria-busy":l.value},[e.direction==="down"?g:u,c(),H(),E(),e.direction==="up"?g:u])}}});const re=C(p),[ee,b,te]=w("pull-refresh"),A=50,ae=["pulling","loosing","success"],ne={disabled:Boolean,modelValue:Boolean,headHeight:k(A),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:K,successDuration:k(500),animationDuration:k(300)};var se=B({name:ee,props:ne,emits:["change","refresh","update:modelValue"],setup(e,{emit:d,slots:i}){let l;const f=P(),v=P(),h=R(f),a=Q({status:"normal",distance:0,duration:0}),o=j(),H=()=>{if(e.headHeight!==A)return{height:`${e.headHeight}px`}},x=()=>a.status!=="loading"&&a.status!=="success"&&!e.disabled,E=t=>{const s=+(e.pullDistance||e.headHeight);return t>s&&(t<s*2?t=s+(t-s)/2:t=s*1.5+(t-s*2)/4),Math.round(t)},c=(t,s)=>{const S=+(e.pullDistance||e.headHeight);a.distance=t,s?a.status="loading":t===0?a.status="normal":t<S?a.status="pulling":a.status="loosing",d("change",{status:a.status,distance:t})},n=()=>{const{status:t}=a;return t==="normal"?"":e[`${t}Text`]||te(t)},g=()=>{const{status:t,distance:s}=a;if(i[t])return i[t]({distance:s});const S=[];return ae.includes(t)&&S.push(r("div",{class:b("text")},[n()])),t==="loading"&&S.push(r(Y,{class:b("loading")},{default:n})),S},u=()=>{a.status="success",setTimeout(()=>{c(0)},+e.successDuration)},m=t=>{l=W(h.value)===0,l&&(a.duration=0,o.start(t))},D=t=>{x()&&m(t)},M=t=>{if(x()){l||m(t);const{deltaY:s}=o;o.move(t),l&&s.value>=0&&o.isVertical()&&(X(t),c(E(s.value)))}},$=()=>{l&&o.deltaY.value&&x()&&(a.duration=+e.animationDuration,a.status==="loosing"?(c(+e.headHeight,!0),d("update:modelValue",!0),y(()=>d("refresh"))):c(0))};return _(()=>e.modelValue,t=>{a.duration=+e.animationDuration,t?c(+e.headHeight,!0):i.success||e.successText?u():c(0,!1)}),V("touchmove",M,{target:v}),()=>{var t;const s={transitionDuration:`${a.duration}ms`,transform:a.distance?`translate3d(0,${a.distance}px, 0)`:""};return r("div",{ref:f,class:b()},[r("div",{ref:v,class:b("track"),style:s,onTouchstartPassive:D,onTouchend:$,onTouchcancel:$},[r("div",{class:b("head"),style:H()},[g()]),(t=i.default)==null?void 0:t.call(i)])])}}});const ce=C(se);export{re as L,ce as P};
