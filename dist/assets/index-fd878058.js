import{u as $e,e as Q,H as re,L as Ce,f as Ie,v as Z,P as Fe,s as He}from"./index-16e70b89.js";import{c as _,Z as Ne,W as A,an as se,d as M,Y as $,aH as G,aI as j,G as k,ao as ye,a4 as pe,ab as Te,a as u,aa as Se,ah as xe,ag as p,t as ce,b as Le,T as O,aJ as Ue,K as L,aK as ee,Q as we,ar as J,m as ke,w as W,aL as je,a7 as te,X as Ke,F as Ye,aM as ze,r as Ge,as as qe,ad as ae}from"./_plugin-vue_export-helper-bbba385e.js";import{a as Je,T as Qe}from"./index-208ffc04.js";import{C as De}from"./index-b28ae8b2.js";import{F as We}from"./index-a77d207a.js";import{F as q}from"./index-4ddbb0fb.js";import{B as de}from"./index-dd584e6f.js";const[Xe,E,me]=_("picker"),Oe=e=>e.find(t=>!t.disabled)||e[0];function Ze(e,t){const a=e[0];if(a){if(Array.isArray(a))return"multiple";if(t.children in a)return"cascade"}return"default"}function ie(e,t){t=se(t,0,e.length);for(let a=t;a<e.length;a++)if(!e[a].disabled)return a;for(let a=t-1;a>=0;a--)if(!e[a].disabled)return a;return 0}const ve=(e,t,a)=>t!==void 0&&!!e.find(s=>s[a.value]===t);function ue(e,t,a){const s=e.findIndex(v=>v[a.value]===t),n=ie(e,s);return e[n]}function et(e,t,a){const s=[];let n={[t.children]:e},v=0;for(;n&&n[t.children];){const r=n[t.children],h=a.value[v];if(n=Ne(h)?ue(r,h,t):void 0,!n&&r.length){const f=Oe(r)[t.value];n=ue(r,f,t)}v++,s.push(r)}return s}function tt(e){const{transform:t}=window.getComputedStyle(e),a=t.slice(7,t.length-1).split(", ")[5];return Number(a)}function at(e){return A({text:"text",value:"value",children:"children"},e)}const fe=200,he=300,nt=15,[Be,ne]=_("picker-column"),Ve=Symbol(Be);var lt=M({name:Be,props:{value:$,fields:G(Object),options:j(),readonly:Boolean,allowHtml:Boolean,optionHeight:G(Number),swipeDuration:G($),visibleOptionNum:G($)},emits:["change","clickOption"],setup(e,{emit:t,slots:a}){let s,n,v,r,h;const f=k(),l=k(),c=k(0),C=k(0),g=$e(),T=()=>e.options.length,P=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,D=m=>{const y=ie(e.options,m),o=-y*e.optionHeight,i=()=>{const x=e.options[y][e.fields.value];x!==e.value&&t("change",x)};s&&o!==c.value?h=i:i(),c.value=o},B=()=>e.readonly||!e.options.length,K=m=>{s||B()||(h=null,C.value=fe,D(m),t("clickOption",e.options[m]))},I=m=>se(Math.round(-m/e.optionHeight),0,T()-1),F=(m,y)=>{const o=Math.abs(m/y);m=c.value+o/.003*(m<0?-1:1);const i=I(m);C.value=+e.swipeDuration,D(i)},H=()=>{s=!1,C.value=0,h&&(h(),h=null)},d=m=>{if(!B()){if(g.start(m),s){const y=tt(l.value);c.value=Math.min(0,y-P())}C.value=0,n=c.value,v=Date.now(),r=n,h=null}},S=m=>{if(B())return;g.move(m),g.isVertical()&&(s=!0,Se(m,!0)),c.value=se(n+g.deltaY.value,-(T()*e.optionHeight),e.optionHeight);const y=Date.now();y-v>he&&(v=y,r=c.value)},b=()=>{if(B())return;const m=c.value-r,y=Date.now()-v;if(y<he&&Math.abs(m)>nt){F(m,y);return}const i=I(c.value);C.value=fe,D(i),setTimeout(()=>{s=!1},0)},V=()=>{const m={height:`${e.optionHeight}px`};return e.options.map((y,o)=>{const i=y[e.fields.text],{disabled:x}=y,z=y[e.fields.value],Y={role:"button",style:m,tabindex:x?-1:0,class:[ne("item",{disabled:x,selected:z===e.value}),y.className],onClick:()=>K(o)},Me={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:i};return u("li",Y,[a.option?a.option(y):u("div",Me,null)])})};return ye(Ve),Q({stopMomentum:H}),pe(()=>{const m=e.options.findIndex(i=>i[e.fields.value]===e.value),o=-ie(e.options,m)*e.optionHeight;c.value=o}),Te("touchmove",S,{target:f}),()=>u("div",{ref:f,class:ne(),onTouchstartPassive:d,onTouchend:b,onTouchcancel:b},[u("ul",{ref:l,style:{transform:`translate3d(0, ${c.value+P()}px, 0)`,transitionDuration:`${C.value}ms`,transitionProperty:C.value?"all":"none"},class:ne("wrapper"),onTransitionend:H},[V()])])}});const[ot]=_("picker-toolbar"),X={title:String,cancelButtonText:String,confirmButtonText:String},st=["cancel","confirm","title","toolbar"],ct=Object.keys(X);var Pe=M({name:ot,props:X,emits:["confirm","cancel"],setup(e,{emit:t,slots:a}){const s=()=>{if(a.title)return a.title();if(e.title)return u("div",{class:[E("title"),"van-ellipsis"]},[e.title])},n=()=>t("cancel"),v=()=>t("confirm"),r=()=>{const f=e.cancelButtonText||me("cancel");return u("button",{type:"button",class:[E("cancel"),re],onClick:n},[a.cancel?a.cancel():f])},h=()=>{const f=e.confirmButtonText||me("confirm");return u("button",{type:"button",class:[E("confirm"),re],onClick:v},[a.confirm?a.confirm():f])};return()=>u("div",{class:E("toolbar")},[a.toolbar?a.toolbar():[r(),s(),h()]])}});const[Ee,le]=_("picker-group"),Ae=Symbol(Ee),it=A({tabs:j(),nextStepText:String},X);M({name:Ee,props:it,emits:["confirm","cancel"],setup(e,{emit:t,slots:a}){const s=k(0),{children:n,linkChildren:v}=xe(Ae);v();const r=()=>s.value<e.tabs.length-1&&e.nextStepText,h=()=>{r()?s.value++:t("confirm",n.map(l=>l.confirm()))},f=()=>t("cancel");return()=>{var l;const c=(l=a.default)==null?void 0:l.call(a),C=r()?e.nextStepText:e.confirmButtonText;return u("div",{class:le()},[u(Pe,{title:e.title,cancelButtonText:e.cancelButtonText,confirmButtonText:C,onConfirm:h,onCancel:f},null),u(Je,{active:s.value,"onUpdate:active":g=>s.value=g,class:le("tabs"),shrink:!0,animated:!0},{default:()=>[e.tabs.map((g,T)=>u(Qe,{title:g,titleClass:le("tab-title")},{default:()=>[c==null?void 0:c[T]]}))]})])}}});const _e=A({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:p(44),showToolbar:ce,swipeDuration:p(1e3),visibleOptionNum:p(6)},X),ut=A({},_e,{columns:j(),modelValue:j(),toolbarPosition:Le("top"),columnsFieldNames:Object});var rt=M({name:Xe,props:ut,emits:["confirm","cancel","change","clickOption","update:modelValue"],setup(e,{emit:t,slots:a}){const s=k(),n=k(e.modelValue.slice(0)),{parent:v}=ye(Ae),{children:r,linkChildren:h}=xe(Ve);h();const f=O(()=>at(e.columnsFieldNames)),l=O(()=>Ue(e.optionHeight)),c=O(()=>Ze(e.columns,f.value)),C=O(()=>{const{columns:o}=e;switch(c.value){case"multiple":return o;case"cascade":return et(o,f.value,n);default:return[o]}}),g=O(()=>C.value.some(o=>o.length)),T=O(()=>C.value.map((o,i)=>ue(o,n.value[i],f.value))),P=O(()=>C.value.map((o,i)=>o.findIndex(x=>x[f.value.value]===n.value[i]))),D=(o,i)=>{if(n.value[o]!==i){const x=n.value.slice(0);x[o]=i,n.value=x}},B=()=>({selectedValues:n.value.slice(0),selectedOptions:T.value,selectedIndexes:P.value}),K=(o,i)=>{D(i,o),c.value==="cascade"&&n.value.forEach((x,z)=>{const Y=C.value[z];ve(Y,x,f.value)||D(z,Y.length?Y[0][f.value.value]:void 0)}),t("change",A({columnIndex:i},B()))},I=(o,i)=>t("clickOption",A({columnIndex:i,currentOption:o},B())),F=()=>{r.forEach(i=>i.stopMomentum());const o=B();return we(()=>{t("confirm",o)}),o},H=()=>t("cancel",B()),d=()=>C.value.map((o,i)=>u(lt,{value:n.value[i],fields:f.value,options:o,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:l.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:x=>K(x,i),onClickOption:x=>I(x,i)},{option:a.option})),S=o=>{if(g.value){const i={height:`${l.value}px`},x={backgroundSize:`100% ${(o-l.value)/2}px`};return[u("div",{class:E("mask"),style:x},null),u("div",{class:[Ie,E("frame")],style:i},null)]}},b=()=>{const o=l.value*+e.visibleOptionNum,i={height:`${o}px`};return u("div",{ref:s,class:E("columns"),style:i},[d(),S(o)])},V=()=>{if(e.showToolbar&&!v)return u(Pe,ke(J(e,ct),{onConfirm:F,onCancel:H}),J(a,st))};L(C,o=>{o.forEach((i,x)=>{i.length&&!ve(i,n.value[x],f.value)&&D(x,Oe(i)[f.value.value])})},{immediate:!0});let m;return L(()=>e.modelValue,o=>{!ee(o,n.value)&&!ee(o,m)&&(n.value=o.slice(0))},{deep:!0}),L(n,o=>{ee(o,e.modelValue)||(m=o.slice(0),t("update:modelValue",m))},{immediate:!0}),Te("touchmove",Se,{target:s}),Q({confirm:F,getSelectedOptions:()=>T.value}),()=>{var o,i;return u("div",{class:E()},[e.toolbarPosition==="top"?V():null,e.loading?u(Ce,{class:E("loading")},null):null,(o=a["columns-top"])==null?void 0:o.call(a),b(),(i=a["columns-bottom"])==null?void 0:i.call(a),e.toolbarPosition==="bottom"?V():null])}}});const U="000000",dt=["title","cancel","confirm","toolbar","columns-top","columns-bottom"],mt=["title","loading","readonly","optionHeight","swipeDuration","visibleOptionNum","cancelButtonText","confirmButtonText"],R=(e="",t=U,a=void 0)=>({text:e,value:t,children:a});function vt({areaList:e,columnsNum:t,columnsPlaceholder:a}){const{city_list:s={},county_list:n={},province_list:v={}}=e,r=t>1,h=t>2,f=()=>{if(r)return a.length?[R(a[0],U,h?[]:void 0)]:[]},l=new Map;Object.keys(v).forEach(g=>{l.set(g.slice(0,2),R(v[g],g,f()))});const c=new Map;if(r){const g=()=>{if(h)return a.length?[R(a[1])]:[]};Object.keys(s).forEach(T=>{const P=R(s[T],T,g());c.set(T.slice(0,4),P);const D=l.get(T.slice(0,2));D&&D.children.push(P)})}h&&Object.keys(n).forEach(g=>{const T=c.get(g.slice(0,4));T&&T.children.push(R(n[g],g))});const C=Array.from(l.values());if(a.length){const g=h?[R(a[2])]:void 0,T=r?[R(a[1],U,g)]:void 0;C.unshift(R(a[0],U,T))}return C}const ft=W(rt),[ht,gt]=_("area"),bt=A({},_e,{modelValue:String,columnsNum:p(3),columnsPlaceholder:j(),areaList:{type:Object,default:()=>({})}});var Ct=M({name:ht,props:bt,emits:["change","confirm","cancel","update:modelValue"],setup(e,{emit:t,slots:a}){const s=k([]),n=k(),v=O(()=>vt(e)),r=(...l)=>t("change",...l),h=(...l)=>t("cancel",...l),f=(...l)=>t("confirm",...l);return L(s,l=>{const c=l.length?l[l.length-1]:"";c&&c!==e.modelValue&&t("update:modelValue",c)},{deep:!0}),L(()=>e.modelValue,l=>{if(l){const c=s.value.length?s.value[s.value.length-1]:"";l!==c&&(s.value=[`${l.slice(0,2)}0000`,`${l.slice(0,4)}00`,l].slice(0,+e.columnsNum))}else s.value=[]},{immediate:!0}),Q({confirm:()=>{var l;return(l=n.value)==null?void 0:l.confirm()},getSelectedOptions:()=>{var l;return((l=n.value)==null?void 0:l.getSelectedOptions())||[]}}),()=>u(ft,ke({ref:n,modelValue:s.value,"onUpdate:modelValue":l=>s.value=l,class:gt(),columns:v.value,onChange:r,onCancel:h,onConfirm:f},J(e,mt)),J(a,dt))}});const yt=W(Ct),[Tt,oe]=_("switch"),St={size:$,loading:Boolean,disabled:Boolean,modelValue:te,activeColor:String,inactiveColor:String,activeValue:{type:te,default:!0},inactiveValue:{type:te,default:!1}};var xt=M({name:Tt,props:St,emits:["change","update:modelValue"],setup(e,{emit:t,slots:a}){const s=()=>e.modelValue===e.activeValue,n=()=>{if(!e.disabled&&!e.loading){const r=s()?e.inactiveValue:e.activeValue;t("update:modelValue",r),t("change",r)}},v=()=>{if(e.loading){const r=s()?e.activeColor:e.inactiveColor;return u(Ce,{class:oe("loading"),color:r},null)}if(a.node)return a.node()};return je(()=>e.modelValue),()=>{var r;const{size:h,loading:f,disabled:l,activeColor:c,inactiveColor:C}=e,g=s(),T={fontSize:Ke(h),backgroundColor:g?c:C};return u("div",{role:"switch",class:oe({on:g,loading:f,disabled:l}),style:T,tabindex:l?void 0:0,"aria-checked":g,onClick:n},[u("div",{class:oe("node")},[v()]),(r=a.background)==null?void 0:r.call(a)])}}});const wt=W(xt),[kt,ge]=_("address-edit-detail"),be=_("address-edit")[2];var Dt=M({name:kt,props:{show:Boolean,rows:$,value:String,rules:Array,focused:Boolean,maxlength:$,searchResult:Array,showSearchResult:Boolean},emits:["blur","focus","input","selectSearch"],setup(e,{emit:t}){const a=k(),s=()=>e.focused&&e.searchResult&&e.showSearchResult,n=l=>{t("selectSearch",l),t("input",`${l.address||""} ${l.name||""}`.trim())},v=()=>{if(!s())return;const{searchResult:l}=e;return l.map(c=>u(De,{clickable:!0,key:(c.name||"")+(c.address||""),icon:"location-o",title:c.name,label:c.address,class:ge("search-item"),border:!1,onClick:()=>n(c)},null))},r=l=>t("blur",l),h=l=>t("focus",l),f=l=>t("input",l);return()=>{if(e.show)return u(Ye,null,[u(q,{autosize:!0,clearable:!0,ref:a,class:ge(),rows:e.rows,type:"textarea",rules:e.rules,label:be("addressDetail"),border:!s(),maxlength:e.maxlength,modelValue:e.value,placeholder:be("addressDetail"),onBlur:r,onFocus:h,"onUpdate:modelValue":f},null),v()])}}});const[Ot,N,w]=_("address-edit"),Re={name:"",tel:"",city:"",county:"",country:"",province:"",areaCode:"",isDefault:!1,addressDetail:""},Bt={areaList:Object,isSaving:Boolean,isDeleting:Boolean,validator:Function,showArea:ce,showDetail:ce,showDelete:Boolean,disableArea:Boolean,searchResult:Array,telMaxlength:$,showSetDefault:Boolean,saveButtonText:String,areaPlaceholder:String,deleteButtonText:String,showSearchResult:Boolean,detailRows:p(1),detailMaxlength:p(200),areaColumnsPlaceholder:j(),addressInfo:{type:Object,default:()=>A({},Re)},telValidator:{type:Function,default:ze}};var Vt=M({name:Ot,props:Bt,emits:["save","focus","delete","clickArea","changeArea","changeDetail","selectSearch","changeDefault"],setup(e,{emit:t,slots:a}){const s=k(),n=Ge({}),v=k(!1),r=k(!1),h=O(()=>qe(e.areaList)&&Object.keys(e.areaList).length),f=O(()=>{const{province:d,city:S,county:b,areaCode:V}=n;if(V){const m=[d,S,b];return d&&d===S&&m.splice(1,1),m.filter(Boolean).join("/")}return""}),l=O(()=>{var d;return((d=e.searchResult)==null?void 0:d.length)&&r.value}),c=d=>{r.value=d==="addressDetail",t("focus",d)},C=O(()=>{const{validator:d,telValidator:S}=e,b=(V,m)=>({validator:y=>{if(d){const o=d(V,y);if(o)return o}return y?!0:m}});return{name:[b("name",w("nameEmpty"))],tel:[b("tel",w("telInvalid")),{validator:S,message:w("telInvalid")}],areaCode:[b("areaCode",w("areaEmpty"))],addressDetail:[b("addressDetail",w("addressEmpty"))]}}),g=()=>t("save",n),T=d=>{n.addressDetail=d,t("changeDetail",d)},P=d=>{n.province=d[0].text,n.city=d[1].text,n.county=d[2].text},D=({selectedValues:d,selectedOptions:S})=>{d.some(b=>b===U)?He(w("areaEmpty")):(v.value=!1,P(S),t("changeArea",S))},B=()=>t("delete",n),K=d=>{n.areaCode=d||""},I=()=>{setTimeout(()=>{r.value=!1})},F=d=>{n.addressDetail=d},H=()=>{if(e.showSetDefault){const d={"right-icon":()=>u(wt,{modelValue:n.isDefault,"onUpdate:modelValue":S=>n.isDefault=S,onChange:S=>t("changeDefault",S)},null)};return ae(u(De,{center:!0,title:w("defaultAddress"),class:N("default")},d),[[Z,!l.value]])}};return Q({setAreaCode:K,setAddressDetail:F}),L(()=>e.addressInfo,d=>{A(n,Re,d),we(()=>{var S;const b=(S=s.value)==null?void 0:S.getSelectedOptions();b&&b.every(V=>V&&V.value!==U)&&P(b)})},{deep:!0,immediate:!0}),()=>{const{disableArea:d}=e;return u(We,{class:N(),onSubmit:g},{default:()=>{var S;return[u("div",{class:N("fields")},[u(q,{modelValue:n.name,"onUpdate:modelValue":b=>n.name=b,clearable:!0,label:w("name"),rules:C.value.name,placeholder:w("name"),onFocus:()=>c("name")},null),u(q,{modelValue:n.tel,"onUpdate:modelValue":b=>n.tel=b,clearable:!0,type:"tel",label:w("tel"),rules:C.value.tel,maxlength:e.telMaxlength,placeholder:w("tel"),onFocus:()=>c("tel")},null),ae(u(q,{readonly:!0,label:w("area"),"is-link":!d,modelValue:f.value,rules:C.value.areaCode,placeholder:e.areaPlaceholder||w("area"),onFocus:()=>c("areaCode"),onClick:()=>{t("clickArea"),v.value=!d}},null),[[Z,e.showArea]]),u(Dt,{show:e.showDetail,rows:e.detailRows,rules:C.value.addressDetail,value:n.addressDetail,focused:r.value,maxlength:e.detailMaxlength,searchResult:e.searchResult,showSearchResult:e.showSearchResult,onBlur:I,onFocus:()=>c("addressDetail"),onInput:T,onSelectSearch:b=>t("selectSearch",b)},null),(S=a.default)==null?void 0:S.call(a)]),H(),ae(u("div",{class:N("buttons")},[u(de,{block:!0,round:!0,type:"primary",text:e.saveButtonText||w("save"),class:N("button"),loading:e.isSaving,nativeType:"submit"},null),e.showDelete&&u(de,{block:!0,round:!0,class:N("button"),loading:e.isDeleting,text:e.deleteButtonText||w("delete"),onClick:B},null)]),[[Z,!l.value]]),u(Fe,{show:v.value,"onUpdate:show":b=>v.value=b,round:!0,teleport:"body",position:"bottom",lazyRender:!1},{default:()=>[u(yt,{modelValue:n.areaCode,"onUpdate:modelValue":b=>n.areaCode=b,ref:s,loading:!h.value,areaList:e.areaList,columnsPlaceholder:e.areaColumnsPlaceholder,onConfirm:D,onCancel:()=>{v.value=!1}},null)]})]}})}}});const It=W(Vt);export{It as A};
